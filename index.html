<html>

<head>
    <title>Test Page</title>
</head>

<body>
    <button onclick="onButtonClick()">TEST</button>
    <script>
        async function onButtonClick() {
            try {
                const device = await navigator.bluetooth.requestDevice({
                    filters: [{ name: 'XJTUANA' }],
                    optionalServices: ["6e400001-b5a3-f393-e0a9-e50e24dcca9e"]
                });

                const server = await device.gatt.connect();

                const service = await server.getPrimaryService("6e400001-b5a3-f393-e0a9-e50e24dcca9e");

                const characteristic = await service.getCharacteristic("6e400002-b5a3-f393-e0a9-e50e24dcca9e");
                await characteristic.writeValue(stringToArrayBuffer("eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCJ9.eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCJ9.b_A7lJJBzh2t1DUZ5pYOCoW0GmmgXDKBA6orzhWUyhb5DU7gaHrDJjg3loK-12MhkWoRZmif71vFw4Eh3_mq5A"));
            } catch (error) {
                alert(error);
            }
        }
        function stringToArrayBuffer(str) {
            var bytes = new Array();
            var len, c;
            len = str.length;
            for (var i = 0; i < len; i++) {
                c = str.charCodeAt(i);
                if (c >= 0x010000 && c <= 0x10FFFF) {
                    bytes.push(((c >> 18) & 0x07) | 0xF0);
                    bytes.push(((c >> 12) & 0x3F) | 0x80);
                    bytes.push(((c >> 6) & 0x3F) | 0x80);
                    bytes.push((c & 0x3F) | 0x80);
                } else if (c >= 0x000800 && c <= 0x00FFFF) {
                    bytes.push(((c >> 12) & 0x0F) | 0xE0);
                    bytes.push(((c >> 6) & 0x3F) | 0x80);
                    bytes.push((c & 0x3F) | 0x80);
                } else if (c >= 0x000080 && c <= 0x0007FF) {
                    bytes.push(((c >> 6) & 0x1F) | 0xC0);
                    bytes.push((c & 0x3F) | 0x80);
                } else {
                    bytes.push(c & 0xFF);
                }
            }
            var array = new Int8Array(bytes.length);
            for (var i = 0; i <= bytes.length; i++) {
                array[i] = bytes[i];
            }
            return array.buffer;
        }
    </script>
</body>

</html>